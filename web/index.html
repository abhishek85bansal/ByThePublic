<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <title>By The People</title>
  <link rel="stylesheet" href="css/bootstrap.css" type="text/css" media="screen" />
  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="js/jquery-1.9.1.min.js"></script>
  <script type="text/javascript"
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjsMQKzBj1D631kw3mb-t6B1hY791FhPs&sensor=true">
  </script>

  <!-- User-generated css -->
  <style type="text/css">
    #map-canvas { height: 500px }
  </style>
  
  <!-- User-generated js -->
  <script type="text/javascript">
    function createMarker(myLatlng, map) {
      var infoWindowContent = document.createElement('div');
      infoWindowContent.setAttribute("class", "infoWindowContent");
      infoWindowContent.setAttribute("style", "font-family:arial; overflow:auto; margin-top:5px;");

      var headTextNode = document.createElement('div');
      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({'latLng': myLatlng}, function(results, status) {
	if (status == google.maps.GeocoderStatus.OK) {
	  if (results[0]) {
	    headTextNode.appendChild(document.createTextNode(results[0].formatted_address));
	  }
	} else {
	  headTextNode.appendChild(document.createTextNode("Details:"));
	}
      });
      headTextNode.setAttribute("style", "font-weight:bold; font-size:20px;");
      infoWindowContent.appendChild(headTextNode);

      var crimeImage = document.createElement('img');
      crimeImage.setAttribute("src", "img/crimetape.jpg");
      crimeImage.setAttribute("style", "height:320; width:320px;");
      infoWindowContent.appendChild(crimeImage);

      var crimeVideo = document.createElement('video');
      crimeVideo.setAttribute("width", 320);
      crimeVideo.setAttribute("controls", "");
      var videoSourceMp4 = document.createElement('source');
      videoSourceMp4.setAttribute("src", "New India Coca cola ad 2011 december_ Reasons to Believe hindi.mp4");
      videoSourceMp4.setAttribute("type", "video/mp4");
      crimeVideo.appendChild(videoSourceMp4);
      infoWindowContent.appendChild(crimeVideo);

      var optTextNode = document.createElement('div');
      optTextNode.appendChild(document.createTextNode("Optional content here"));
      infoWindowContent.appendChild(optTextNode);

      var infoWindow = new google.maps.InfoWindow({
	position: myLatlng,
	content: infoWindowContent,
	zindex: 1000
      });

      var marker = new google.maps.Marker({
	position: myLatlng
      });

      marker.setMap(map);
      marker.addListener('click', function(){infoWindow.open(map)});
    }

    function initialize() {
      var myLatlng = new google.maps.LatLng(37.483513540485,-122.14942535723);
      
      var mapOptions = {
	center: myLatlng,
	zoom: 12,
	mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"),
	  mapOptions);

      //TODO: loop for all markers
      createMarker(myLatlng, map);
    }
    $(document).ready(function() {
      initialize();
    });
  </script>
  <script type="text/javascript">

    var timeout;

    function refreshFeed(){
        $.ajax({
            type: "GET",
            url: "/servicearchitecture/rest/incident/top10",
            //data: "{empid: " + empid + "}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(response) {
                alert(response.d);
                var html = '<li>' +
                    '    <img src="img/crimetape.jpg" alt="image" width="424" height="283" /><br/>' +
                    '    <p class="description">Caption here</p>' +
                    '    <button>Like</button>' +
                    '    <button>Share</button>' +
                    '    <button>Report Spam</button>' +
                    '</li>';
                $("#feedlist").html(html);
            },
            error: function(xhr, status, error) {
                alert(error); 
                //$("#feedlist").html("Error loading feeds!");
                clearTimeout(timeout);
            }
        });
        timeout = setTimeout(refreshFeed, 2000);
    }

    $(function() {
        refreshFeed();
    });

  </script>

</head>
<body>

<!-- facebook integration code -->
<div id="fb-root"></div>
  <script>
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=496562937069311";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
   </script>
   
<div class="container">
    <!-- #wrapper -->
    
     <div class="nav">
       <img src="img/Detective_Bond/Web/img_logo2.png" alt="detective logo">
       <img src="img/Detective_Bond/Web/title.png" alt="From The Public logo">
       <a class="btn btn-info" style="float:right; margin-top:15px; margin-right:15px;">Feedback</a>
       </div>
    
   
    <!-- Maps -->
    <div id="map" class="well">
        <h2>Map for the incidences</h2>
        <div id="map-canvas"></div>
    </div>
    <br/>
    
    <!-- Live Feeds -->
    <h2>Live Feeds</h2>
    <div class="content">
        <!-- <div class="search">
            <input name="q" id="searchinput" placeholder="Search by zip code or time"
            value="" type="search">
        </div> -->

        <ul id="feedlist">
            <li>
                <a href="#"><img src="img/crimetape.jpg" alt="image" width="424" height="283" /></a><br/>
                <p class="description">Caption here</p>
                <!-- FB Like and Send button -->
                <div class="fb-like" data-href="http://philster.x10.bz/phd4/" data-send="true" data-layout="button_count" data-width="450" data-show-faces="true"></div>
                <button onclick="alert('Spam reported.');return false;">Report Spam</button>
            </li>
        </ul>
    </div>
</div>

</body>
</html>